# ====================================================================
# Open Operator Platform (OOP) - Unified Configuration
# ====================================================================
# 
# This chart deploys the complete Open Operator Platform including:
# - SRM (Service Resource Manager)
# - OEG (Open Exposure Gateway)
# - Federation Manager (to be added)
#
# ====================================================================

# Global settings applied to all components
global:
  # Namespace for all OOP components
  namespace: oop
  
  # Common labels applied to all resources
  labels:
    platform: oop
    version: "1.0.0"

# ====================================================================
# SRM (Service Resource Manager)
# ====================================================================
srm:
  # Enable/disable SRM deployment
  enabled: true
  
  # Inherit global namespace
  global:
    namespace: oop
  
  # MongoDB for SRM
  mongodb:
    enabled: true
    name: mongosrm
    
    image:
      repository: mongo
      tag: latest
      pullPolicy: IfNotPresent
    
    service:
      type: ClusterIP
      port: 27017
    
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
    
    persistence:
      enabled: true
      storageClass: manual
      accessMode: ReadWriteOnce
      size: 200Mi
      hostPath:
        enabled: true
        path: /mnt/data/mongodb_srm
      createPV: true
  
  # SRM Controller
  srmcontroller:
    enabled: true
    name: srmcontroller
    replicaCount: 1
    
    image:
      repository: ghcr.io/sunriseopenoperatorplatform/srm/srm
      tag: 1.0.1
      pullPolicy: Always
    
    service:
      name: srm
      type: NodePort
      port: 8080
      targetPort: 8080
      nodePort: 32415
    
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 500m
        memory: 512Mi
    
    # SRM Environment Configuration
    env:
      # Kubernetes API configuration
      kubernetesMasterIp: "kubernetes.default.svc.cluster.local"
      kubernetesMasterPort: "443"
      kubernetesUsername: admin
      k8sNamespace: oop
      
      # MongoDB connection
      empStorageUri: "mongodb://mongosrm:27017"
      
      # ⚠️ IMPORTANT: Update this with your actual token
      kubernetesMasterToken: "eyJhbGciOiJSUzI1NiIsImtpZCI6IkRBY1JqMzFqUUxhWG43VUtQeGNPajBjOS1qQkphR2FYN0wyMFZ5UWEyRzAifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoyMDc4OTA5MjMyLCJpYXQiOjE3NjM1NDkyMzIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiYWIwNTNhYmYtYzcwOC00N2NiLThhZWMtYzY2OTQwZmM5M2MzIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJvb3AiLCJzZXJ2aWNlYWNjb3VudCI6eyJuYW1lIjoib29wLXVzZXIiLCJ1aWQiOiI3Y2NjOTc0NC05NmY0LTQ1YWItODBiNC0wZTc3Nzk3YWE4NTYifX0sIm5iZiI6MTc2MzU0OTIzMiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Om9vcDpvb3AtdXNlciJ9.kUG_NGfvm30VdrY71Bt-hYacm43JPtdU9HqsG7wAKpdhpfaAkl_KbpXLcmd7JuimdY6HW8PK3ysB3jVirtOX1AEErKaTmu4S9QTK7uNWisOZtp8f-jhWCj18AYNuB9gG1_U1LhGj4WB5jwDp-maX9G1Ea236ZAgRamyOs-RAQ0_XAAX9xfwfG7z31XqfORnpJ73s8GICBri91YQCDNotozcAj9dEsDN_sdSoHrxjVu4WtExtdrvYbDOv6SoYnJpEoqcWG-_PWEmX2SR262QO9DO2yAhDeP-35aYk5tQXF6JEJ6_bvtvJAIAwLuN_fIKYwrUPkvQ_51rjIYr4Ch5CAw"
      
      # Service endpoints
      artifactManagerAddress: "http://artefact-manager-service:8000"
      
      # Adapter configuration
      edgeCloudAdapterName: kubernetes
      adapterBaseUrl: "kubernetes.default.svc.cluster.local"
      
      # Platform identification
      platformProvider: "Open Operator Platform"
  
  # Artifact Manager
  artifactManager:
    enabled: true
    name: artefact-manager
    replicaCount: 1
    
    image:
      repository: ghcr.io/sunriseopenoperatorplatform/artefactmanager
      tag: "0.5"
      pullPolicy: IfNotPresent
    
    service:
      name: artefact-manager-service
      type: NodePort
      port: 8000
      targetPort: 8000
      nodePort: 30080
    
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
    
    env:
      pythonPath: "/app"
  
  # Common annotations
  commonAnnotations:
    platform: "Open Operator Platform"
    component: "srm"

# ====================================================================
# OEG (Open Exposure Gateway)
# ====================================================================
oeg:
  # Enable/disable OEG deployment
  enabled: true
  
  # Inherit global namespace
  global:
    namespace: oop
  
  # MongoDB for OEG
  mongodb:
    enabled: true
    name: oegmongo
    
    image:
      repository: mongo
      tag: latest
      pullPolicy: IfNotPresent
    
    service:
      type: ClusterIP
      port: 27017
    
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
    
    persistence:
      enabled: true
      storageClass: manual
      accessMode: ReadWriteOnce
      size: 50Mi
      hostPath:
        enabled: true
        path: /mnt/data/mongodb_oeg
      createPV: true
  
  # OEG Controller
  oegcontroller:
    enabled: true
    name: oegcontroller
    replicaCount: 1
    
    image:
      repository: ghcr.io/sunriseopenoperatorplatform/oeg/oeg
      tag: 1.0.1
      pullPolicy: Always
    
    service:
      name: oeg
      type: NodePort
      port: 80
      targetPort: 8080
      nodePort: 32263
    
    resources:
      limits:
        cpu: 1000m
        memory: 1Gi
      requests:
        cpu: 500m
        memory: 512Mi
    
    # OEG Environment Configuration
    env:
      # MongoDB connection
      mongoUri: "mongodb://oegmongo:27017"
      
      # SRM connection
      srmHost: "http://srm:8080/srm/1.0.0"
      
      # Federation Manager connection (will be updated when FM is added)
      federationManagerHost: "http://federation-manager:8080/api/v1"
  
  # Ingress configuration (disabled by default)
  ingress:
    enabled: false
    className: traefik
    host: oop.example.com
    path: /oeg
    pathType: Prefix
  
  # Common annotations
  commonAnnotations:
    platform: "Open Operator Platform"
    component: "oeg"

# ====================================================================
# Federation Manager
# ====================================================================
# NOTE: Federation Manager deploys to its OWN namespace (federation-manager)
#       This is separate from the OOP platform namespace for security isolation
# ====================================================================
federationManager:
  enabled: true
  createNamespace: false 
  # Federation Manager uses its own namespace
  global:
    namespace: federation-manager
  
  # Keycloak Configuration
  keycloak:
    enabled: true
    service:
      nodePort: 30081
    
    # Default admin credentials (change in production!)
    admin:
      username: admin
      password: admin
  
  # Federation Manager Configuration
  federationManager:
    enabled: true
    service:
      nodePort: 30989
    
    config:
      mongodb:
        # Connect to MongoDB in oop namespace (cross-namespace access)
        host: "mongosrm.oop.svc.cluster.local"
        port: "27017"
      
      op_data:
        partnerOPFederationId: "oop-platform"
        partnerOPCountryCode: "GR"  # Update to your country
        # ... other settings can be customized
  
  # OpenVPN sidecar (disabled by default)
  openvpn:
    enabled: false

# ====================================================================
# Common Labels
# ====================================================================
commonLabels:
  platform: oop
  managed-by: helm

# ====================================================================
# Common Annotations
# ====================================================================
commonAnnotations:
  platform: "Open Operator Platform"
  version: "1.0.0"
